{"version":3,"sources":["meteor://ðŸ’»app/server/server.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;AASE,WAAW,CAAC,KAAK,CAAC;AAChB,QAAM,EAAE,YAAY;AAAE,WAAO,IAAI,CAAC;GAAE;AACpC,QAAM,EAAE,YAAY;AAAE,WAAO,IAAI,CAAC;GAAE;AACpC,QAAM,EAAE,YAAY;AAAE,WAAO,IAAI,CAAC;GAAE;CACrC,CAAC,CAAC;AACH,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC;AACjB,QAAM,EAAE,YAAY;AAAE,WAAO,IAAI,CAAC;GAAE;AACpC,QAAM,EAAE,YAAY;AAAE,WAAO,IAAI,CAAC;GAAE;AACpC,QAAM,EAAE,YAAY;AAAE,WAAO,IAAI,CAAC;GAAE;CACrC,CAAC,CAAC;;;;;;;AAOH,MAAM,CAAC,OAAO,CAAC,YAAW;AACxB,SAAO,CAAC,GAAG,CAAC,QAAQ,GAAC,yEAAyE,CAAC;;AAE/F,UAAQ,CAAC,cAAc,CAAC,IAAI,GAAG,iCAAiC,CAAC;;AAEjE,UAAQ,CAAC,cAAc,CAAC,QAAQ,GAAG,QAAQ,CAAC;;AAE5C,UAAQ,CAAC,cAAc,CAAC,WAAW,CAAC,OAAO,GAAG,UAAS,IAAI,EAAE;AAC3D,WAAO,oBAAoB,CAAC;GAC7B,CAAC;AACF,UAAQ,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,GAAG,UAAS,IAAI,EAAE,GAAG,EAAE;AAC7D,WAAO,mBAAmB,GAC1B,2BAA2B,GAC3B,sIAAsI,GACtI,sDAAsD,GACtD,GAAG,GAAG,MAAM,GACZ,qFAAqF,GACrF,QAAQ,GACR,aAAa;GACd,CAAC;;;CAIH,CAAC,CAAC;;AAEL,YAAY,CAAC,YAAY,CAAC,UAAU,EAAE,UAAS,UAAU,EAAE,OAAO,EAAE;AAClE,MAAI,OAAO,GAAG,EAAC,IAAI,EAAE,EAAC,QAAQ,EAAE,CAAC,CAAC,EAAC,EAAE,KAAK,EAAE,EAAE,EAAC,CAAC;;AAEhD,MAAG,UAAU,EAAE;AACb,QAAI,MAAM,GAAG,WAAW,CAAC,UAAU,CAAC,CAAC;AACrC,QAAI,QAAQ,GAAG,EAAC,GAAG,EAAE,CAAC,EAAC,KAAK,EAAE,MAAM,EAAC,EAAC,EAAC,OAAO,EAAE,MAAM,EAAC,EAAC,EAAC,GAAG,EAAE,UAAU,EAAC,CAAC,EAAC,CAAC;AAC5E,WAAO,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC,KAAK,EAAE,CAAC;GAC/C,MAAM;AACL,WAAO,MAAM,CAAC,IAAI,CAAC,EAAE,EAAE,OAAO,CAAC,CAAC,KAAK,EAAE,CAAC;GACzC;CACF,CAAC,CAAC;;AAEH,SAAS,WAAW,CAAC,UAAU,EAAE;;AAE/B,MAAI,KAAK,GAAG,UAAU,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;AAChD,SAAO,IAAI,MAAM,CAAC,GAAG,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,EAAE,IAAI,CAAC,CAAC;CACtD;;AAED,IAAI,gBAAgB,GAAG,UAAS,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE;AAC3D,eAAa,CAAC,MAAM,CAAC;AACnB,QAAI,EAAE,IAAI;AACV,UAAM,EAAE,MAAM;AACd,WAAO,EAAE,OAAO;AAChB,QAAI,EAAE,KAAK;AACX,aAAS,EAAE,IAAI,IAAI,EAAE;AACrB,QAAI,EAAE,IAAI;GACX,CAAC;CACH;;AAED,IAAI,QAAQ,GAAG,UAAS,IAAI,EAAE,OAAO,EAAE;AACrC,MAAI,CAAC,IAAI,CAAC;AACR,QAAI,EAAE,QAAQ;AACd,SAAK,EAAE,wBAAwB;AAC/B,QAAI,EAAE,OAAO;AACb,SAAK,EAAE,CAAC;AACR,SAAK,EAAE,OAAO;AACd,SAAK,EAAE;AACL,YAAM,EAAE,IAAI;KACb;GACF,CAAC,CAAC;CACJ;;AAID,MAAM,CAAC,OAAO,CAAC;AACb,iBAAe,EAAE,UAAS,OAAO,EAAE;;AAEjC,QAAI,eAAe,GAAG,OAAO,CAAC;AAC9B,WAAO,CAAC,GAAG,CAAC,mBAAmB,GAAE,eAAe,CAAC,CAAC;AAClD,QAAI,iCAAiC,GAAI,MAAM,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;AAC7E,QAAI,MAAM,GAAG,iCAAiC,CAAC,OAAO,CAAC,CAAC;;AAExD,QAAI,MAAM,CAAC,IAAI,IAAK,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,8BAA+B,EAAE;AAChF,aAAO,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACtC,YAAM,IAAI,MAAM,CAAC,KAAK,CAAC,yCAAyC,CAAC,CAAC;KACnE,MAAM;AACH,UAAI,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,IAAK,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,MAAO,EAAE;AACpH,eAAO,sBAAsB,CAAC,MAAM,CAAC,CAAC;OACvC,MAAM;AACL,eAAO,CAAC,GAAG,CAAC,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;AACtF,cAAM,IAAI,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;OACpG;KACF;GACF;;AAED,uBAAqB,EAAE,UAAS,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE;AACtD,UAAM,CAAC,KAAK,CAAC,MAAM,CAAC,EAAC,KAAK,EAAE,MAAM,EAAC,EAAE,EAAC,IAAI,EAAE,EAAC,QAAQ,EAAE,CAAC,EAAC,SAAS,EAAE,KAAK,EAAE,UAAU,EAAE,KAAK,EAAC,CAAC,EAAE,iBAAiB,EAAE,OAAO,EAAC,EAAC,EAAE,UAAS,KAAK,EAAE;AAC5I,UAAI,CAAC,KAAK,EAAE;AACV,gBAAQ,CAAC,qBAAqB,CAAC,MAAM,CAAC,CAAC;OACxC;KACF,CAAC,CAAC;GACJ;;AAED,gBAAc,EAAE,UAAS,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE;AAClD,UAAM,CAAC,KAAK,CAAC,MAAM,CAAC,EAAC,GAAG,EAAE,QAAQ,EAAC,EAAE,EAAC,KAAK,EAAE,EAAC,gBAAgB,EAAE,MAAM,EAAC,EAAC,CAAC,CAAC;AAC1E,QAAI,WAAW,GAAG,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC;AAC7D,QAAI,OAAO,GAAG,sBAAsB,GAAG,MAAM,GAAG,QAAQ,GAAG,WAAW,CAAC;;AAEvE,YAAQ,CAAC,QAAQ,EAAE,OAAO,CAAC;AAC3B,oBAAgB,CAAC,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,CAAC;GAErD;;AAED,YAAU,EAAE,UAAS,YAAY,EAAE;AACjC,QAAI,OAAO,GAAG,WAAW,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;AAChD,QAAI,YAAY,GAAG,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC;;AAExE,eAAW,CAAC,MAAM,CAAC,EAAC,GAAG,EAAE,YAAY,EAAC,EAAE,EAAC,IAAI,EAAE,EAAC,OAAO,EAAE,QAAQ,EAAC,EAAC,CAAC,CAAC;;AAErE,QAAI,OAAO,GAAG,YAAY,GAAG,4BAA4B,GAAG,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC;AACnF,YAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;AAC5C,oBAAgB,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,EAAE,OAAO,CAAC,SAAS,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;GAChF;;AAED,eAAa,EAAE,UAAS,QAAQ,EAAE,YAAY,EAAE;AAC9C,QAAI,OAAO,GAAG,WAAW,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;AAChD,QAAI,SAAS,GAAG,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC;;AAE5E,UAAM,CAAC,MAAM,CAAC,EAAC,GAAG,EAAE,QAAQ,EAAC,EAAE,EAAC,IAAI,EAAE,EAAC,GAAG,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;;AAEjD,QAAI,OAAO,GAAG,SAAS,GAAG,4BAA4B,GAAG,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC;AAChF,YAAQ,CAAC,OAAO,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;AACrC,oBAAgB,CAAC,OAAO,CAAC,SAAS,EAAE,OAAO,CAAC,QAAQ,CAAC,OAAO,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;GAChF;;AAED,cAAY,EAAE,UAAS,WAAW,EAAE,SAAS,EAAE,OAAO,EAAE;AACtD,WAAO,CAAC,GAAG,CAAC,WAAW,EAAE,SAAS,EAAE,OAAO,CAAC,CAAC;;AAE7C,QAAI,aAAa,GAAG,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC;AACnE,QAAI,IAAI,GAAG,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;;AAEvC,QAAI,UAAU,GAAG;AACf,eAAS,EAAE,WAAW;AACtB,WAAK,EAAE,SAAS;AAChB,iBAAW,EAAE,IAAI,IAAI,EAAE;AACvB,kBAAY,EAAE,IAAI;AAClB,cAAQ,EAAE,IAAI;AACd,UAAI,EAAE,EAAI;AACV,oBAAc,EAAE,kBAAkB;AAClC,mBAAa,EAAE,kBAAkB;KAClC,CAAC;;AAEF,eAAW,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;;AAE/B,QAAI,OAAO,GAAG,aAAa,GAAG,0BAA0B,GAAG,IAAI,CAAC,KAAK;AACrE,YAAQ,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;AAC3B,oBAAgB,CAAC,OAAO,EAAE,WAAW,EAAE,OAAO,EAAE,SAAS,CAAC,CAAC;;AAE3D,WAAO,IAAI,CAAC;GAEb;AACD,eAAa,EAAE,UAAS,YAAY,EAAE;AACpC,UAAM,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;AACzB,WAAO,CAAC,GAAG,CAAC,yCAAyC,CAAC,CAAC;;AAEvD,QAAI,OAAO,GAAG,WAAW,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;AAChD,QAAI,SAAS,GAAG,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC;;AAE5E,eAAW,CAAC,MAAM,CAAC,EAAC,cAAc,EAAE,OAAO,CAAC,QAAQ,CAAC,GAAG,EAAE,WAAW,EAAE,EAAC,GAAG,EAAE,OAAO,CAAC,SAAS,EAAC,EAAC,CAAC,CAAC;AAClG,eAAW,CAAC,MAAM,CAAC,EAAC,GAAG,EAAE,YAAY,EAAC,EAAE,EAAC,IAAI,EAAE,EAAC,KAAK,EAAE,SAAS,EAAC,EAAC,CAAC,CAAC;;AAEpE,QAAI,OAAO,GAAG,SAAS,GAAG,6BAA6B,GAAG,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC;AACjF,YAAQ,CAAC,OAAO,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;AACrC,oBAAgB,CAAC,OAAO,CAAC,SAAS,EAAE,OAAO,CAAC,QAAQ,CAAC,OAAO,EAAE,OAAO,EAAE,UAAU,CAAC,CAAC;;AAEnF,WAAO,IAAI,CAAC;GACb;AACD,gBAAc,EAAE,UAAS,YAAY,EAAE;AACrC,UAAM,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;;AAEzB,QAAI,OAAO,GAAG,WAAW,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;AAChD,QAAI,SAAS,GAAG,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC;;AAE5E,QAAI,OAAO,GAAI,mBAAmB,GAAG,OAAO,CAAC,QAAQ,CAAC,KAAK,GAAG,qBAAqB,CAAC;AACpF,YAAQ,CAAC,OAAO,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;AACrC,oBAAgB,CAAC,OAAO,CAAC,SAAS,EAAE,OAAO,CAAC,QAAQ,CAAC,OAAO,EAAE,OAAO,EAAE,UAAU,CAAC,CAAC;;AAEnF,eAAW,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;;AAEjC,WAAO,IAAI,CAAC;GACb;AACD,UAAQ,EAAE,UAAS,KAAK,EAAE;AACxB,WAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AACnB,UAAM,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;AACzB,eAAW,CAAC,MAAM,CAAC,EAAC,GAAG,EAAE,KAAK,EAAC,EAAE,EAAC,IAAI,EAAE,EAAC,KAAK,EAAE,QAAQ,EAAC,EAAC,CAAC,CAAC;AAC5D,WAAO,mBAAmB;GAC3B;AACD,cAAY,EAAE,UAAS,eAAe,EAAE,WAAW,EAAE,gBAAgB,EAAE,MAAM,EAAE,YAAY,EAAE,cAAc,EAAE,uBAAuB,EAAE;AACpI,QAAI,CAAC,OAAO,EAAE,CAAC;AACf,WAAO,CAAC,GAAG,CAAC,eAAe,EAAE,WAAW,EAAE,gBAAgB,EAAE,MAAM,EAAE,YAAY,EAAE,cAAc,EAAE,uBAAuB,CAAC,CAAC;AAC3H,QAAI,eAAe,GAAG,CAAC,MAAM,GAAG,GAAG,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC;;AAEhD,QAAG;AACD,UAAI,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC;AACjC,cAAM,EAAE,eAAe;AACvB,gBAAQ,EAAE,KAAK;AACf,gBAAQ,EAAE,eAAe;AACzB,cAAM,EAAE,WAAW;AACnB,mBAAW,EAAE,gBAAgB;OAC9B,CAAC,CAAC;;AAEH,aAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AACpB,UAAI,MAAM,CAAC,MAAM,KAAK,WAAW,EAAE;AACjC,YAAI,UAAU,GAAG;AACf,cAAI,EAAE,MAAM,CAAC,OAAO;AACpB,qBAAW,EAAE,WAAW,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,KAAK;AAC7D,oBAAU,EAAE,MAAM,CAAC,MAAM,GAAC,GAAG;SAC9B;;AAED,YAAI,cAAc,GAAG;AACnB,cAAI,EAAE,MAAM,CAAC,OAAO;AACpB,qBAAW,EAAE,WAAW,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,KAAK;AAC7D,wBAAc,EAAE,MAAM,CAAC,MAAM,GAAC,GAAG;SAClC;;AAED,mBAAW,CAAC,MAAM,CAAC,EAAC,GAAG,EAAE,YAAY,EAAC,EAAE,EAAC,IAAI,EAAE,EAAC,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAE,MAAM,EAAC,EAAC,CAAC,CAAC;AACpF,cAAM,CAAC,MAAM,CAAC,EAAC,KAAK,EAAE,WAAW,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,GAAG,EAAC,EAAE,EAAC,IAAI,EAAE,EAAC,GAAG,EAAE,CAAC,CAAC,EAAC,EAAC,CAAC;AACzF,oBAAY,CAAC,MAAM,CAAC,EAAC,GAAG,EAAE,cAAc,EAAC,EAAE,EAAC,KAAK,EAAE,EAAC,QAAQ,EAAE,UAAU,EAAC,EAAC,CAAC,CAAC;AAC5E,oBAAY,CAAC,MAAM,CAAC,EAAC,GAAG,EAAE,uBAAuB,EAAC,EAAE,EAAC,KAAK,EAAE,EAAC,OAAO,EAAE,cAAc,EAAC,EAAC,CAAC,CAAC;;AAExF,YAAI,kBAAkB,GAAG,WAAW,CAAC,OAAO,CAAC,YAAY,CAAC;AAC1D,YAAI,UAAU,GAAG,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,IAAI;AAChF,YAAI,OAAO,GAAG,6BAA6B,GAAG,MAAM,GAAG,QAAQ,GAAG,UAAU;AAC5E,gBAAQ,CAAC,kBAAkB,CAAC,QAAQ,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;AACvD,wBAAgB,CAAC,kBAAkB,CAAC,QAAQ,CAAC,OAAO,EAAE,kBAAkB,CAAC,SAAS,EAAE,OAAO,EAAE,MAAM,CAAC;OAErG;KAEF,CAAC,OAAM,CAAC,EAAE;AACT,aAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;KAChB;GACF;AACD,kBAAgB,EAAE,UAAS,YAAY,EAAE;AACvC,WAAO,CAAC,GAAG,CAAC,4DAA4D,GAAC,YAAY,CAAC,CAAC;AACvF,QAAI,CAAC,OAAO,EAAE,CAAC;AACf,QAAI;AACF,UAAI,MAAM,GAAG,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC;AACnC,qBAAa,EAAE,YAAY;OAC5B,CAAC,CAAC;AACH,aAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AACpB,UAAI,MAAM,CAAC,EAAE,EAAE;AACb,cAAM,CAAC,KAAK,CAAC,MAAM,CAAC,EAAC,KAAK,EAAE,YAAY,EAAC,EAAE,EAAC,IAAI,EAAE,EAAC,kBAAkB,EAAE,MAAM,EAAC,EAAC,CAAC;OACjF;KACF,CAAC,OAAM,CAAC,EAAE;;AAET,YAAM,IAAI,MAAM,CAAC,KAAK,CAAC,0DAA0D,CAAC,CAAC;KACpF;GACF;AACD,aAAW,EAAE,YAAW;AACtB,QAAI,CAAC,OAAO,EAAE,CAAC;AACf,QAAI;AACF,UAAI,MAAM,GAAG,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,oBAAoB,CAAC,CAAC;AAC9D,aAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;KACrB,CAAC,OAAM,CAAC,EAAC;AACR,aAAO,CAAC,GAAG,CAAC,CAAC,CAAC;KACf;GACF;;AAED,kBAAgB,EAAE,UAAS,OAAO,EAAE,UAAU,EAAE,YAAY,EAAE;AAC5D,WAAO,CAAC,GAAG,CAAC,OAAO,EAAE,UAAU,EAAE,YAAY,CAAC,CAAC;AAC/C,QAAI,CAAC,OAAO,EAAE,CAAC;AACf,QAAI;AACF,UAAI,MAAM,GAAG,MAAM,CAAC,SAAS,CAAC,YAAY,CAAE,UAAU,EAAG,OAAO,CAAC,CAAC;AAClE,aAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;;AAEpB,UAAI,MAAM,CAAC,EAAE,EAAE;AACb,YAAI,QAAQ,GAAG,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;AACtD,eAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;AACtB,cAAM,CAAC,KAAK,CAAC,MAAM,CAAC,EAAC,KAAK,EAAE,YAAY,EAAC,EAAE,EAAC,IAAI,EAAE,EAAC,eAAe,EAAE,QAAQ,EAAC,EAAC,CAAC;OAChF;KACF,CAAC,OAAM,CAAC,EAAE;AACT,aAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AACf,YAAM,IAAI,MAAM,CAAC,KAAK,CAAC,oCAAoC,CAAC,CAAC;KAC9D;GACF;;AAED,gBAAc,EAAE,UAAS,OAAO,EAAE,eAAe,EAAE,YAAY,EAAE;AAC/D,WAAO,CAAC,GAAG,CAAC,OAAO,EAAE,eAAe,EAAE,YAAY,CAAC,CAAC;AACpD,QAAI,CAAC,OAAO,EAAE,CAAC;AACf,QAAI;;AAEF,UAAI,SAAS,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC;AACnC,sBAAc,EAAE,kBAAkB;AACjC,yBAAiB,EAAE,EAAE;AACrB,wBAAgB,EAAE,IAAI;AACtB,mBAAW,EAAE,KAAK;AAClB,wBAAgB,EAAE,KAAK;OACzB,CAAC,CAAC;AACH,aAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;;AAEvB,UAAI,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAE,eAAe,EAAE;AACpD,wBAAgB,EAAE,SAAS,CAAC,EAAE;OAC/B,CAAC,CAAC;;AAEH,UAAI,MAAM,CAAC,EAAE,EAAE;AACb,cAAM,CAAC,KAAK,CAAC,MAAM,CAAC,EAAC,KAAK,EAAE,YAAY,EAAC,EAAE,EAAC,IAAI,EAAE,EAAC,oBAAoB,EAAE,MAAM,EAAC,EAAC,CAAC;OACnF;KACF,CAAC,OAAM,CAAC,EAAE;AACT,aAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AACf,YAAM,IAAI,MAAM,CAAC,KAAK,CAAC,oCAAoC,CAAC,CAAC;KAC9D;GACF;;AAED,sBAAoB,EAAE,UAAS,YAAY,EAAE;AAC3C,QAAI,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC;AAC7D,QAAI,CAAC,OAAO,EAAE,CAAC;;AAEf,QAAI,CAAE,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,OAAO,CAAC,aAAa,EAAE;AAC9D,UAAI;AACF,YAAI,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;AAClC,iBAAO,EAAE,IAAI;AACb,iBAAO,EAAE,IAAI;AACb,eAAK,EAAE,KAAK;SACb,CAAC,CAAC;AACH,eAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;;AAEpB,YAAI,MAAM,CAAC,EAAE,EAAE;AACb,gBAAM,CAAC,KAAK,CAAC,MAAM,CAAC,EAAC,KAAK,EAAE,YAAY,EAAC,EAAE,EAAC,IAAI,EAAE,EAAC,uBAAuB,EAAE,MAAM,EAAC,EAAC,CAAC;SACtF;OACF,CAAC,OAAM,KAAK,EAAE;AACb,eAAO,CAAC,GAAG,CAAC,KAAK,CAAC;OACnB;KACF,MAAM;AACL,aAAO,CAAC,GAAG,CAAC,+BAA+B,CAAC,CAAC;AAC7C,aAAO,IAAI,CAAC;KACb;GACF;;AAED,uBAAqB,EAAE,UAAS,SAAS,EAAE,QAAQ,EAAE,GAAG,EAAE,aAAa,EAAE,WAAW,EAAE,YAAY,EAAE;AAClG,QAAI,CAAC,OAAO,EAAE,CAAC;;AAEf,QAAI;AACF,UAAI,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;AAClC,iBAAS,EAAE,IAAI;AACf,iBAAS,EAAE,IAAI;AACf,4BAAoB,EAAE,YAAY;AAClC,kCAA0B,EAAE,SAAS;AACrC,iCAAyB,EAAE,QAAQ;AACnC,kCAA0B,EAAE,GAAG;;;;;AAK/B,8BAAsB,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC;AACrD,4BAAoB,EAAE,SAAS;AAC/B,+BAAuB,EAAE,IAAI;AAC7B,sCAA8B,EAAE,aAAa;AAC7C,sCAA8B,EAAE,WAAW;OAC5C,CAAC;;AAEF,aAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AACpB,UAAI,MAAM,CAAC,EAAE,EAAE;AACb,cAAM,CAAC,KAAK,CAAC,MAAM,CAAC,EAAC,KAAK,EAAE,YAAY,EAAC,EAAE,EAAC,IAAI,EAAE,EAAC,uBAAuB,EAAE,MAAM,EAAC,EAAC,CAAC;OACtF;AACD,aAAO,IAAI,CAAC;KACb,CACD,OAAM,KAAK,EAAE;AACX,aAAO,CAAC,GAAG,CAAC,KAAK,CAAC;AAClB,YAAM,IAAI,MAAM,CAAC,KAAK,CAAC,8BAA8B,CAAC,CAAC;KACxD;GACF;AACD,eAAa,EAAG,UAAS,YAAY,EAAE;;AAErC,QAAG,CAAC,YAAY,EAChB;AACE,aAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;KACvB;;AAED,QAAI,CAAC,IAAI,CAAC,8CAA8C,EACxD;AACE,eAAS,EACT;AACE,uBAAe,EAAG,oDAAoD;OACvE;AACD,cAAQ,EACR;AACE,yCAAiC,EAAE,8EAA8E;;AAEjH,+BAAuB,EAAG,OAAO;OAClC;KACF,EACD,UAAU,KAAK,EAAE,QAAQ,EACzB;AACE,UAAG,CAAC,KAAK,EACT;AACE,eAAO,CAAC,GAAG,CAAC,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC;OACzD,MAED;AACE,eAAO,CAAC,GAAG,CAAC,qBAAqB,GAAG,KAAK,CAAC,CAAC;OAC5C;KAEF,CAAC,CAAC;GAEJ;AACD,eAAa,EAAE,YAAW;AACxB,QAAI,CAAC,OAAO,EAAE,CAAC;AACf,QAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDL,UAAI,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;AACnC,iBAAS,EAAE,IAAI;AACf,iBAAS,EAAE,IAAI;AACf,4BAAoB,EAAE,YAAY;AAClC,kCAA0B,EAAE,MAAM;AAClC,iCAAyB,EAAE,KAAK;AAChC,kCAA0B,EAAE,IAAI;AAChC,sCAA8B,EAAE,WAAW;AAC3C,qCAA6B,EAAE,eAAe;AAC9C,sCAA8B,EAAE,IAAI;AACpC,4CAAoC,EAAE,OAAO;AAC7C,8BAAsB,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC;AACrD,4BAAoB,EAAE,SAAS;AAC/B,+BAAuB,EAAE,IAAI;AAC7B,sCAA8B,EAAE,WAAW;AAC3C,sCAA8B,EAAE,cAAc;OAC9C,CAAC;;AAEC,aAAO,CAAC,GAAG,CAAC,MAAM,CAAC;AACnB,aAAO,IAAI,CAAC;KACb,CACD,OAAM,KAAK,EAAE;AACX,aAAO,CAAC,GAAG,CAAC,KAAK,CAAC;AAClB,YAAM,IAAI,MAAM,CAAC,KAAK,CAAC,gBAAgB,EAAE,oBAAoB,CAAC,CAAC;KAChE;GACF;CACF,CAAC;;AAIF,IAAI,sBAAsB,GAAG,UAAS,MAAM,EAAE;AAC5C,SAAO,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC;;AAEpC,MAAI,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,EAAC;AAC1C,QAAI,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,SAAS,EAAE;;AAE7E,UAAI,eAAe,GAAG;AACpB,aAAK,EAAG,CAAC,YAAW;AAAC,iBAAO,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,GAAG,IAAI;SAAC,GAAG;AAC5M,aAAK,EAAG,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;AAC7E,gBAAQ,EAAG,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC;AACvF,iBAAS,EAAG,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;AACrF,aAAK,EAAE,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;AACvE,eAAO,EAAE,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC;AACpE,uBAAe,EAAE,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC;AAChG,aAAK,EAAE,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC;AACpF,WAAG,EAAE,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;AACxE,eAAO,EAAE,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;;AAEhF,eAAO,EAAE,CAAC,YAAW;AACnB,cAAI,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,MAAM,EAAE;AACvE,mBAAO,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;WAC9E,MAAM;AACL,mBAAO,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;WACjF;SACF,GAAG;OACL;;AAEH,aAAO,eAAe,CAAC;KACxB,MAAM;AACL,YAAM,IAAI,MAAM,CAAC,KAAK,CAAC,8DAA8D,CAAC;KACvF;GACN,MAAM;AACL,WAAO,CAAC,GAAG,CAAC,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;AACtF,UAAM,IAAI,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;GACrG;CACF;;AAED,iBAAiB,GAAG,UAAS,OAAO,EAAE,QAAQ,EAAE;AAC9C,iBAAe,GAAG,IAAI,CAAC,eAAe,CAAC;;AAEvC,MAAI,QAAQ,GAAG,IAAI,eAAe,CAAC;AACjC,SAAK,EAAM,sBAAsB;AACjC,aAAS,EAAE,0CAA0C;AACrD,WAAO,EAAI,kBAAkB;GAC9B,CAAC,CAAC;;AAEH,UAAQ,CAAC,OAAO,CAAC,YAAY,EAAE;AAC7B,iBAAa,EAAE,KAAK;AACpB,eAAW,EAAE,YAAY;AACzB,YAAQ,EAAE,OAAO;AACjB,YAAQ,EAAE,MAAM;AAChB,mBAAe,EAAE,CAAC,gBAAgB,EAAE,QAAQ,EAAE,eAAe,CAAC;AAC9D,2BAAuB,EAAE,KAAK;AAC9B,mBAAe,EAAE,CAAC;GACnB,EAAE,QAAQ,CAAE;CACd","file":"/server/server.js","sourcesContent":["  //SERVER FRESH START SEQUENCE\n  // Meteor.users.remove({});\n  // Products.remove({});\n  // Search.remove({});\n  // Connections.remove({});\n  // Transactions.remove({}); \n  // Notifications.remove({});\n\n\n  Connections.allow({\n    insert: function () { return true; },\n    update: function () { return true; },\n    remove: function () { return true; }\n  });\n  Meteor.users.allow({\n    insert: function () { return true; },\n    update: function () { return true; },\n    remove: function () { return true; }\n  });\n  // SERVER FRESH START SEQUENCE\n\n// ServiceConfiguration.loginServiceConfiguration.remove({\n//     service: \"facebook\"\n// });\n\n  Meteor.startup(function() {\n    process.env.MAIL_URL=\"smtp://partio.missioncontrol%40gmail.com:partio2021@smtp.gmail.com:465/\";\n\n    Accounts.emailTemplates.from = 'partio.missioncontrol@gmail.com';\n\n    Accounts.emailTemplates.siteName = 'partiO';\n\n    Accounts.emailTemplates.verifyEmail.subject = function(user) {\n      return 'Welcome to partiO!';\n    };\n    Accounts.emailTemplates.verifyEmail.text = function(user, url) {\n      return \"Hello there! \\n\\n\" +\n      \"Welcome aboard partiO! \\n\" +\n      \"The things you own end up making money for you! Sounds familiar? Er..nevermind! To make this happen, it all starts with one link. \\n\" +\n      \"The one below. Click to verify and get sharing! \\n\\n\" +\n      url + \"\\n\\n\" +\n      \"For any queries or support, feel free to contact partio.missioncontrol@gmail.com \\n\" +\n      \"Best\\n\" +\n      \"partiO team\"\n    };\n\n    // Stripe = StripeSync('sk_test_RBrpczGtVbB1tSaG66gglMTH');\n\n  });\n\nSearchSource.defineSource('packages', function(searchText, options) {\n  var options = {sort: {isoScore: -1}, limit: 20};\n\n  if(searchText) {\n    var regExp = buildRegExp(searchText);\n    var selector = {$or: [{title: regExp},{authors: regExp},{ean: searchText}]};\n    return Search.find(selector, options).fetch();\n  } else {\n    return Search.find({}, options).fetch();\n  }\n});\n\nfunction buildRegExp(searchText) {\n\n  var parts = searchText.trim().split(/[ \\-\\:]+/);\n  return new RegExp(\"(\" + parts.join('|') + \")\", \"ig\");\n}\n\nvar sendNotification = function(toId, fromId, message, type) {\n  Notifications.insert({\n    toId: toId,\n    fromId: fromId,\n    message: message,\n    read: false,\n    timestamp: new Date(),\n    type: type\n  })\n}\n\nvar sendPush = function(toId, message) {\n  Push.send({\n    from: 'partiO',\n    title: 'New activity on partiO',\n    text: message,\n    badge: 1,\n    sound: 'check',\n    query: {\n      userId: toId\n    }\n  });\n}\n\n\n\nMeteor.methods({\n  priceFromAmazon: function(barcode) {\n    // var originalFormat = format;\n    var originalBarcode = barcode;\n    console.log(\"originalBarcode: \"+ originalBarcode);\n    var getAmazonPriceSearchSynchronously =  Meteor.wrapAsync(amazonPriceSearch);\n    var result = getAmazonPriceSearchSynchronously(barcode);\n\n    if (result.html && (result.html.body[0].b[0] === \"Http/1.1 Service Unavailable\")) {\n      console.log(result.html.body[0].b[0]);\n      throw new Meteor.Error(\"Error from Amazon - Service Unavailable\");\n    } else {\n        if (result.ItemLookupResponse.Items[0].Item && (result.ItemLookupResponse.Items[0].Request[0].IsValid[0] === \"True\")) {\n          return amazonResultProcessing(result);\n        } else {\n          console.log(result.ItemLookupResponse.Items[0].Request[0].Errors[0].Error[0].Code[0]);\n          throw new Meteor.Error(result.ItemLookupResponse.Items[0].Request[0].Errors[0].Error[0].Code[0]);\n      }\n    }\n  },\n\n  'updateOfficialEmail': function(userId, college, email) {\n    Meteor.users.update({\"_id\": userId}, {$set: {\"emails\": [{\"address\": email, \"verified\": false}], \"profile.college\": college}}, function(error) {\n      if (!error) {\n        Accounts.sendVerificationEmail(userId);\n      }\n    });\n  },\n\n  'submitRating': function(rating, personId, ratedBy) {\n    Meteor.users.update({_id: personId}, {$push: {\"profile.rating\": rating}});\n    var ratedByName = Meteor.users.findOne(ratedBy).profile.name;\n    var message = 'You got a rating of ' + rating + ' from ' + ratedByName;\n\n    sendPush(personId, message)\n    sendNotification(personId, ratedBy, message, \"info\")\n\n  },\n\n  returnBook: function(connectionId) {\n    var connect = Connections.findOne(connectionId);\n    var borrowerName = Meteor.users.findOne(connect.requestor).profile.name;\n     \n    Connections.update({_id: connectionId}, {$set: {\"state\": \"RETURN\"}});\n\n    var message = borrowerName + \" wants to return the book \" + connect.bookData.title;\n    sendPush(connect.bookData.ownerId, message);\n    sendNotification(connect.bookData.ownerId, connect.requestor, message, \"info\");\n  },\n\n  confirmReturn: function(searchId, connectionId) {\n    var connect = Connections.findOne(connectionId);\n    var ownerName = Meteor.users.findOne(connect.bookData.ownerId).profile.name;\n    \n    Search.update({_id: searchId}, {$inc: {qty: 1}});\n\n    var message = ownerName + \" confirmed your return of \" + connect.bookData.title;\n    sendPush(connect.requestor, message);\n    sendNotification(connect.requestor, connect.bookData.ownerId, message, \"info\");\n  },\n\n  requestOwner: function(requestorId, productId, ownerId) {\n    console.log(requestorId, productId, ownerId);\n\n    var requestorName = Meteor.users.findOne(requestorId).profile.name;\n    var book = Products.findOne(productId); \n\n    var connection = {\n      requestor: requestorId,\n      state: 'WAITING',\n      requestDate: new Date(),\n      borrowedDate: null,\n      bookData: book,\n      chat: [  ],\n      meetupLocation: \"Location not set\",\n      meetupLatLong: \"Location not set\"\n    };\n\n    Connections.insert(connection);\n    \n    var message = requestorName + \" sent you a request for \" + book.title  \n    sendPush(ownerId, message);\n    sendNotification(ownerId, requestorId, message, \"request\");\n\n    return true;\n\n  },\n  'ownerAccept': function(connectionId) {\n    Meteor._sleepForMs(1000);\n    console.log(\"changing status from Waiting to Payment\");\n\n    var connect = Connections.findOne(connectionId);\n    var ownerName = Meteor.users.findOne(connect.bookData.ownerId).profile.name;\n \n    Connections.remove({\"bookData._id\": connect.bookData._id, \"requestor\": {$ne: connect.requestor}});\n    Connections.update({_id: connectionId}, {$set: {state: \"PAYMENT\"}});\n\n    var message = ownerName + \" accepted your request for \" + connect.bookData.title; \n    sendPush(connect.requestor, message);\n    sendNotification(connect.requestor, connect.bookData.ownerId, message, \"approved\");\n\n    return true;\n  },\n  'ownerDecline': function(connectionId) {\n    Meteor._sleepForMs(1000);\n    \n    var connect = Connections.findOne(connectionId);\n    var ownerName = Meteor.users.findOne(connect.bookData.ownerId).profile.name;\n    \n    var message =  \"Your request for \" + connect.bookData.title + \" has been declined.\"; \n    sendPush(connect.requestor, message);\n    sendNotification(connect.requestor, connect.bookData.ownerId, message, \"declined\");\n\n    Connections.remove(connectionId);\n\n    return true;\n  },\n  'payNow': function(payer) {\n    console.log(payer);\n    Meteor._sleepForMs(1000);\n    Connections.update({_id: payer}, {$set: {state: \"IN USE\"}});\n    return \"yes, payment done\"\n  },\n  'chargeCard': function(payerCustomerId, payerCardId, recipientDebitId, amount, connectionId, transactionsId, transactionsRecipientId) {\n    this.unblock();\n    console.log(payerCustomerId, payerCardId, recipientDebitId, amount, connectionId, transactionsId, transactionsRecipientId);\n    var formattedAmount = (amount * 100).toFixed(0);\n\n    try{\n      var result = Stripe.charges.create({\n        amount: formattedAmount,\n        currency: \"usd\",\n        customer: payerCustomerId,\n        source: payerCardId,\n        destination: recipientDebitId\n      });\n\n      console.log(result);\n      if (result.status === 'succeeded') {\n        var payerTrans = {\n          date: result.created,\n          productName: Connections.findOne(connectionId).bookData.title,\n          paidAmount: result.amount/100\n        }\n\n        var recipientTrans = {\n          date: result.created,\n          productName: Connections.findOne(connectionId).bookData.title,\n          receivedAmount: result.amount/100\n        }\n\n        Connections.update({_id: connectionId}, {$set: {state: \"IN USE\", payment: result}});\n        Search.update({\"ean\": Connections.findOne(connectionId).bookData.ean}, {$inc: {qty: -1}})\n        Transactions.update({_id: transactionsId}, {$push: {spending: payerTrans}});\n        Transactions.update({_id: transactionsRecipientId}, {$push: {earning: recipientTrans}});\n\n        var thisConnectionData = Connections.findOne(connectionId)\n        var moneyGiver = Meteor.users.findOne(thisConnectionData.requestor).profile.name\n        var message = 'You received a payment of $' + amount + ' from ' + moneyGiver\n        sendPush(thisConnectionData.bookData.ownerId, message);\n        sendNotification(thisConnectionData.bookData.ownerId, thisConnectionData.requestor, message, \"info\")\n\n      }\n\n    } catch(e) {\n      console.log(e);\n    }\n  },\n  'createCustomer': function(MeteorUserId) {\n    console.log(\"creating customer for stripe on server using this ID ---> \"+MeteorUserId);\n    this.unblock();\n    try {\n      var result = Stripe.customers.create({\n        \"description\": MeteorUserId\n      });\n      console.log(result);\n      if (result.id) {\n        Meteor.users.update({\"_id\": MeteorUserId}, {$set: {\"profile.customer\": result}})\n      }\n    } catch(e) {\n      // console.log(e);\n      throw new Meteor.Error('Error while adding user as a customer to payment profile');\n    }\n  },\n  'listCards': function() {\n    this.unblock();\n    try {\n      var result = Stripe.customers.listCards('cus_6omXOz0ZAXVwrm');\n      console.log(result);\n    } catch(e){\n      console.log(e)\n    }\n  },\n\n  'addPaymentCard': function(tokenId, customerId, MeteorUserId) {\n    console.log(tokenId, customerId, MeteorUserId);\n    this.unblock();\n    try {\n      var result = Stripe.customers.createSource( customerId , tokenId);\n      console.log(result);\n\n      if (result.id) {\n        var allCards = Stripe.customers.listCards(customerId);\n        console.log(allCards);\n        Meteor.users.update({\"_id\": MeteorUserId}, {$set: {\"profile.cards\": allCards}})\n      }\n    } catch(e) {\n      console.log(e);\n      throw new Meteor.Error('Error while adding card to account');\n    }\n  },\n\n  'addDebitCard': function(tokenId, stripeAccountId, MeteorUserId) {\n    console.log(tokenId, stripeAccountId, MeteorUserId);\n    this.unblock();\n    try {\n\n      var cardToken = Stripe.tokens.create({\n        \"card[number]\": '4000056655665556',\n         \"card[exp_month]\": 12,\n         \"card[exp_year]\": 2016,\n         \"card[cvc]\": '123',\n         \"card[currency]\": 'usd'\n      });\n      console.log(cardToken);\n\n      var result = Stripe.accounts.update( stripeAccountId, {\n        external_account: cardToken.id\n      });\n\n      if (result.id) {\n        Meteor.users.update({\"_id\": MeteorUserId}, {$set: {\"profile.payoutCard\": result}})\n      }\n    } catch(e) {\n      console.log(e);\n      throw new Meteor.Error('Error while adding card to account');\n    }\n  },\n\n  'createDebitAccount': function(MeteorUserId) {\n    var email = Meteor.users.findOne(MeteorUserId).profile.email;\n    this.unblock();\n\n    if (! Meteor.users.findOne(MeteorUserId).profile.stripeAccount) {\n      try {\n        var result = Stripe.accounts.create({\n          managed: true,\n          country: 'US',\n          email: email\n        });\n        console.log(result);\n\n        if (result.id) {\n          Meteor.users.update({\"_id\": MeteorUserId}, {$set: {\"profile.stripeAccount\": result}})\n        }\n      } catch(error) {\n        console.log(error)\n      }\n    } else {\n      console.log(\"Stripe Account already exists\");\n      return true;\n    }\n  },\n\n  'createStripeAccount': function(firstname, lastname, ssn, routingnumber, bankaccount, MeteorUserId) {\n    this.unblock();\n\n    try {\n      var result = Stripe.accounts.create({\n        \"managed\": true,\n        \"country\": \"US\",\n        \"legal_entity[type]\": \"individual\",\n        \"legal_entity[first_name]\": firstname,\n        \"legal_entity[last_name]\": lastname,\n        \"legal_entity[ssn_last_4]\": ssn,\n        // \"legal_entity[address][line1]\": \"Some lane\",\n        // \"legal_entity[address][city]\": \"San Francisco\",\n        // \"legal_entity[address][state]\": \"TX\",\n        // \"legal_entity[address][postal_code]\": \"12345\",\n        \"tos_acceptance[date]\": Math.floor(Date.now() / 1000),\n        \"tos_acceptance[ip]\": \"8.8.8.8\",\n        \"bank_account[country]\": \"US\",\n        \"bank_account[routing_number]\": routingnumber,\n        \"bank_account[account_number]\": bankaccount\n      })\n\n      console.log(result);\n      if (result.id) {\n        Meteor.users.update({\"_id\": MeteorUserId}, {$set: {\"profile.stripeAccount\": result}})\n      }\n      return true;\n    }\n    catch(error) {\n      console.log(error)\n      throw new Meteor.Error('Error while creating account');\n    }\n  },\n  'camFindCall' : function(argImageData) {\n\n    if(!argImageData)\n    {\n      console.log('error!');\n    }\n\n    HTTP.post('https://camfind.p.mashape.com/image_requests', \n    { \n      \"headers\": \n      {\n        \"X-Mashape-Key\" : \"7W5OJWzlcsmshYSMTJW8yE4L2mJQp1cuOVKjsneO6N0wPTpaS1\"\n      },\n      \"params\" :\n      {\n        \"image_request[remote_image_url]\": \"http://logok.org/wp-content/uploads/2014/03/Air-Jordan-Nike-Jumpman-logo.png\",\n        // \"image_request[image]\" : argImageData,\n        \"image_request[locale]\" : \"en_US\"\n      }      \n    },  \n    function( error, response ) \n    {\n      if(!error)\n      {\n        console.log('camFindCall: ' + JSON.stringify(response));  \n      }\n      else\n      {\n        console.log('camFindCall error: ' + error);   \n      }\n      \n    });\n\n  },\n  'createNAAAH': function() {\n    this.unblock();\n    try {\n      // var result = Stripe.accounts.create({\n      //   managed: true,\n      //   country: 'US',\n      //   email: 'mail.krishna@aol.com'\n      // });\n\n    // var result = Stripe.accounts.create({\n    //   managed: true,\n    //   country: 'US'\n    // })\n\n    // var result = Stripe.charges.create({\n    //     amount: 5000,\n    //     currency: 'usd',\n    //     customer: 'cus_6oRs14YG2c4pYy',\n    //     description: \"new payment\",\n    //     destination: \"acct_16akhXKN2gXXNyID\",\n    //     application_fee: 800,\n    //     receipt_email: \"nishanth.saka@gmail.com\"\n    //   });\n\n    // var result = Stripe.customers.create({\n    //   description: \"this is tankampa's account\",\n    //   source: \"tok_16al3yG9HDjn1DNAkYW0RRZZ\"\n    // })\n\n\n\n    // var result = Stripe.accounts.retrieve({\n    //   id: \"acct_16akhXKN2gXXNyID\"\n    // });\n\n    // var result = Stripe.accounts.update(\"acct_16akhXKN2gXXNyID\", {\n    //   // \"legal_entity[dob[day]]\": \"02\",\n    //   // \"legal_entity[dob[month]]\": \"11\",\n    //   // \"legal_entity[dob[year]]\": \"1980\",\n    //   // \"legal_entity[first_name]\": \"Tankampa\",\n    //   // \"legal_entity[last_name]\": \"haha\",\n    //   // \"tos_acceptance[date]\": Math.floor(Date.now() / 1000),\n    //   // \"tos_acceptance[ip]\": '123.123.9.1',\n      // \"bank_account[country]\": 'US',\n      // \"bank_account[routing_number]\": '110000000',\n      // \"bank_account[account_number]\": '000123456789'\n      // \"legal_entity[ssn_last_4]\": 1234,\n      // \"legal_entity[address][line1]\": \"Some lane\",\n      // \"legal_entity[address][city]\": \"San Francisco\",\n      // \"legal_entity[address][state]\": \"TX\",\n      // \"legal_entity[address][postal_code]\": \"12345\"\n    //   }\n    //   // \"support_phone\": \"555-867-5309\"\n    // )\n\n   var result = Stripe.accounts.create({\n    \"managed\": true,\n    \"country\": \"US\",\n    \"legal_entity[type]\": \"individual\",\n    \"legal_entity[first_name]\": \"Test\",\n    \"legal_entity[last_name]\": \"Man\",\n    \"legal_entity[ssn_last_4]\": 1234,\n    \"legal_entity[address][line1]\": \"Some lane\",\n    \"legal_entity[address][city]\": \"San Francisco\",\n    \"legal_entity[address][state]\": \"TX\",\n    \"legal_entity[address][postal_code]\": \"12345\",\n    \"tos_acceptance[date]\": Math.floor(Date.now() / 1000),\n    \"tos_acceptance[ip]\": \"8.8.8.8\",\n    \"bank_account[country]\": \"US\",\n    \"bank_account[routing_number]\": \"110000000\",\n    \"bank_account[account_number]\": \"000123456789\"\n   })\n\n      console.log(result)\n      return true;\n    }\n    catch(error) {\n      console.log(error)\n      throw new Meteor.Error('payment-failed', 'The payment failed');\n    }\n  }\n})\n\n\n\nvar amazonResultProcessing = function(result) {\n  console.log(JSON.stringify(result));\n  \n  if (result.ItemLookupResponse.Items[0].Item){\n    if (result.ItemLookupResponse.Items[0].Item[0].ItemAttributes[0].ISBN !== undefined) {\n          // try {\n            var necessaryFields = {\n              price : (function() {return result.ItemLookupResponse.Items[0].Item[0].Offers[0].Offer ? result.ItemLookupResponse.Items[0].Item[0].Offers[0].Offer[0].OfferListing[0].Price[0].FormattedPrice[0] : \"--\"})(),\n              title : result.ItemLookupResponse.Items[0].Item[0].ItemAttributes[0].Title[0],\n              category : result.ItemLookupResponse.Items[0].Item[0].ItemAttributes[0].ProductGroup[0],\n              publisher : result.ItemLookupResponse.Items[0].Item[0].ItemAttributes[0].Publisher[0],\n              image: result.ItemLookupResponse.Items[0].Item[0].MediumImage[0].URL[0],\n              pageUrl: result.ItemLookupResponse.Items[0].Item[0].DetailPageURL[0],\n              publicationDate: result.ItemLookupResponse.Items[0].Item[0].ItemAttributes[0].PublicationDate[0],\n              pages: result.ItemLookupResponse.Items[0].Item[0].ItemAttributes[0].NumberOfPages[0],\n              ean: result.ItemLookupResponse.Items[0].Item[0].ItemAttributes[0].EAN[0],\n              binding: result.ItemLookupResponse.Items[0].Item[0].ItemAttributes[0].Binding[0],\n              // authors: result.ItemLookupResponse.Items[0].Item[0].ItemAttributes[0].Author[0]\n              authors: (function() {\n                if (result.ItemLookupResponse.Items[0].Item[0].ItemAttributes[0].Author) {\n                  return result.ItemLookupResponse.Items[0].Item[0].ItemAttributes[0].Author[0]\n                } else {\n                  return result.ItemLookupResponse.Items[0].Item[0].ItemAttributes[0].Creator[0]._\n                }\n              })()\n            }\n          // } catch(e) {console.log(e)}\n          return necessaryFields;\n        } else {\n          throw new Meteor.Error(\"No match for this item. Are you sure you're scanning a Book?\")\n        }\n  } else {\n    console.log(result.ItemLookupResponse.Items[0].Request[0].Errors[0].Error[0].Code[0]);\n    throw new Meteor.Error(result.ItemLookupResponse.Items[0].Request[0].Errors[0].Error[0].Message[0]);\n  }\n}\n\namazonPriceSearch = function(barcode, callback) {\n  OperationHelper = apac.OperationHelper;\n\n  var opHelper = new OperationHelper({\n    awsId:     'AKIAJ5R6HKU33B4DAF3A',\n    awsSecret: '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',\n    assocId:   'codefynecom06-20'\n  });\n\n  opHelper.execute('ItemLookup', {\n    'SearchIndex': 'All',\n    'Operation': 'ItemLookup',\n    'ItemId': barcode,\n    'IdType': 'ISBN',\n    'ResponseGroup': ['ItemAttributes', 'Images', 'OfferListings'],\n    'IncludeReviewsSummary': false,\n    'VariationPage': 1\n  }, callback )\n}\n\n\n\n\n\n//   { \n//   statusCode: 200,\n//   content: '{\"access_token\": \"b82cad2ac582b2fe4bbc313aa7c9a9a528794bde7df025a7b8e0fd51e6773799\", \"expires_in\": 5184000, \"token_type\": \"bearer\", \"user\": {\"username\": \"gabriel-simoes\", \"first_name\": \"Gabriel\", \"last_name\": \"Simoes\", \"display_name\": \"Gabriel Simoes\", \"is_friend\": false, \"friends_count\": 154, \"is_active\": true, \"about\": \" \", \"email\": \"gsimoes@rollins.edu\", \"phone\": \"14079511926\", \"profile_picture_url\": \"https://s3.amazonaws.com/venmo/no-image.gif\", \"friend_request\": null, \"is_blocked\": false, \"trust_request\": null, \"id\": \"1494475771740160877\", \"identity\": null, \"date_joined\": \"2014-08-24T23:36:35\"}, \"balance\": \"0.00\", \"refresh_token\": \"85e487232f4c28b4097eb4951912eb0439d75aefbe4d285ee2ab3f715811aeb9\"}',\n//   headers: \n//    { server: 'nginx',\n//      date: 'Thu, 30 Jul 2015 14:25:50 GMT',\n//      'content-type': 'application/json; charset=UTF-8',\n//      'content-length': '711',\n//      connection: 'close',\n//      vary: 'Accept-Encoding',\n//      'set-cookie': [ 'csrftoken2=d9a26966efc94d45a2856fe40f4928ad; Domain=.venmo.com; Path=/' ],\n//      expires: 'Thu, 30 Jul 2015 14:25:49 GMT',\n//      'cache-control': 'no-cache',\n//      'strict-transport-security': 'max-age=31536000' },\n//   data: \n//    { access_token: 'b82cad2ac582b2fe4bbc313aa7c9a9a528794bde7df025a7b8e0fd51e6773799',\n//      expires_in: 5184000,\n//      token_type: 'bearer',\n//      user: \n//       { username: 'gabriel-simoes',\n//         first_name: 'Gabriel',\n//         last_name: 'Simoes',\n//         display_name: 'Gabriel Simoes',\n//         is_friend: false,\n//         friends_count: 154,\n//         is_active: true,\n//         about: ' ',\n//         email: 'gsimoes@rollins.edu',\n//         phone: '14079511926',\n//         profile_picture_url: 'https://s3.amazonaws.com/venmo/no-image.gif',\n//         friend_request: null,\n//         is_blocked: false,\n//         trust_request: null,\n//         id: '1494475771740160877',\n//         identity: null,\n//         date_joined: '2014-08-24T23:36:35' },\n//      balance: '0.00',\n//      refresh_token: '85e487232f4c28b4097eb4951912eb0439d75aefbe4d285ee2ab3f715811aeb9' } \n// }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// amazonInitialTestData = function(callback) {\n//   OperationHelper = apac.OperationHelper;\n\n//   var opHelper = new OperationHelper({\n//     awsId:     'AKIAJ5R6HKU33B4DAF3A',\n//     awsSecret: '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',\n//     assocId:   'codefynecom06-20'\n//   });\n\n//   opHelper.execute('ItemSearch', {\n//     'SearchIndex': 'Blended',\n//     'Operation': 'ItemSearch',\n//     'Keywords': 'tesla',\n//     'ResponseGroup': ['ItemAttributes', 'Images', 'OfferListings']\n//   }, callback )\n// }\n\n// var productGroup = [];\n// Products.find().map(function(eachProduct) {\n//   productGroup.push(eachProduct.category);\n// })\n\n// photograph\n// university\n// college\n// football\n\n// Meteor.startup(function() {\n//   Meteor.setTimeout(function() {\n//     console.log('data dump attempt...');\n//     var getInitialData =  Meteor.wrapAsync(amazonInitialTestData);\n//     var result = getInitialData();\n//     console.log(JSON.stringify(result));\n\n//     var dump1 = result.ItemSearchResponse.Items[0].Item;\n//     // console.log(dump1);\n\n//     dump1.forEach(function(itemSet) {\n//       console.log(itemSet);\n//       if (itemSet.ItemAttributes && itemSet.MediumImage && itemSet.Offers) {\n//           if (itemSet.ItemAttributes[0].ISBN !== undefined) {\n//             var necessaryFields = {\n//               price : (function() {return itemSet.Offers[0].Offer ? itemSet.Offers[0].Offer[0].OfferListing[0].Price[0].FormattedPrice[0] : \"--\"})(),\n//               title : itemSet.ItemAttributes[0].Title[0],\n//               category : itemSet.ItemAttributes[0].ProductGroup[0],\n//               publisher : itemSet.ItemAttributes[0].Publisher[0],\n//               image: itemSet.MediumImage[0].URL[0],\n//               pageUrl: itemSet.DetailPageURL[0],\n//               publicationDate: itemSet.ItemAttributes[0].PublicationDate[0],\n//               pages: (function() {return itemSet.ItemAttributes[0].NumberOfPages ? itemSet.ItemAttributes[0].NumberOfPages[0] : \"--\"})(),\n//               ean: itemSet.ItemAttributes[0].EAN[0],\n//               binding: itemSet.ItemAttributes[0].Binding[0],\n//               authors: (function() {return itemSet.ItemAttributes[0].Authors ? itemSet.ItemAttributes[0].Authors[0] : \"--\"})()\n//             }\n//             console.log(necessaryFields);\n//             var customPrice = necessaryFields.price.split(\"$\")[1];\n//             var insertData = _.extend(necessaryFields, {\n//               \"ownerId\": \"DbRr7gwsFk5gPcPvq\",\n//               \"customPrice\": (Number(customPrice)/5).toFixed(2)\n//             });\n//             Products.insert(insertData);\n\n//           } else {\n//             var necessaryFields = {\n//               price : (function() {return itemSet.Offers[0].Offer ? itemSet.Offers[0].Offer[0].OfferListing[0].Price[0].FormattedPrice[0] : \"--\"})(),\n//               title : itemSet.ItemAttributes[0].Title[0],\n//               category : itemSet.ItemAttributes[0].ProductGroup[0],\n//               manufacturer : (function() {return itemSet.ItemAttributes[0].Manufacturer ? itemSet.ItemAttributes[0].Manufacturer[0] : \"--\"})(),\n//               brand : (function() {return itemSet.ItemAttributes[0].Brand ? itemSet.ItemAttributes[0].Brand[0] : \"--\"})(),\n//               image: itemSet.MediumImage[0].URL[0],\n//               asin: itemSet.ASIN[0],\n//               pageUrl: itemSet.DetailPageURL[0],\n//               model: (function() {return itemSet.ItemAttributes[0].Model ? itemSet.ItemAttributes[0].Model[0] : \"--\"})()\n//             }\n//             console.log(necessaryFields);\n//             var customPrice = necessaryFields.price.split(\"$\")[1];\n//             var insertData = _.extend(necessaryFields, {\n//               \"ownerId\": \"DbRr7gwsFk5gPcPvq\",\n//               \"customPrice\": (Number(customPrice)/5).toFixed(2)\n//             });\n//             Products.insert(insertData);\n//           }\n//       } else {\n//         return;\n//       }\n//     })\n\n\n//   }, 5000)\n// })\n\n\n"]}