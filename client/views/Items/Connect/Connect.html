<template name="connect">
  {{#contentFor "headerButtonLeft"}}
      {{>ionNavBackButton}}
  {{/contentFor}}

  {{#contentFor "headerTitle"}}
    <h1 class="title" style="text-align:center;">Rent Request</h1>
  {{/contentFor}}

  {{#ionView class="connect-view"}}
    {{#ionContent class="connect prevent-keyboardglitch"}}
      {{#if Template.subscriptionsReady}}
        <script>
          Meteor.setTimeout(function(){
            $('.loadbox').fadeOut('medium',function(){
                $('.loading-wrapper').fadeIn('medium');
            });
          }, 500);
        </script>
      {{/if}}

      {{>loader}}

      <div class="loading-wrapper">
        <div class="card card-limited padding-horizontal padding-vertical list">
          <div class="item item-divider product-details"><h2>Product Details <i class="chevron-icon icon ion-chevron-up"></i></h2>
          </div>

          <div class="item product-details-item">

            <div class="item">
                <span class="product-title">{{connectData.productData.title}}</span>
                <div class="image-container">
                    <a>
                        <img src="{{connectData.productData.image}}">
                    </a>
                </div>
            </div>

            <div class="item product-features no-padding-top">
                <div class="col col-50">
                    <p><i class="icon {{../getCategoryIcon}}"></i> {{connectData.productData.amazonCategory}}</p>
                </div>
                <div class="col col-50">
                   <p><i class="icon ion-clipboard"></i> {{../getCondition}}</p>
                </div>
            </div>

          </div>

          <div class="item item-divider profile-details"><h2>Renting Details </h2></div>

          <div class="item request-date">
              <span>{{../getRequestDate}}</span>
          </div>

          <div class="item profile">
              <div class="profile-image-box">
                <a href="/profile/items/{{ connectData.requestor }}">
                    <div style="background: url('{{ ../requestorAvatar }}') no-repeat; background-size:cover; background-position: 50% 50%;" class="profile-avatar"></div>
                </a>
                <p class="main-title-text">{{requestorInfo.profile.name}} </p>
              </div>
  <!--
              <div class="profile-content">
                <a class="item" href="{{pathFor 'talk' _id=connectData._id}}">
                    <i class="icon ion-chatbubbles assertive"></i>
                    CHAT
                </a>
                <a class="item" id="btnCallUser">
                    <i class="icon ion-ios-telephone assertive"></i>
                    CALL
                </a>

                {{#if ../paymentPending}}
                    <a class="item" id="cancelRequest">
                        <i class="icon ion-ios-close royal"></i>
                        CANCEL
                    </a>
                {{/if}}
              </div>
  -->
            </div>
            <div class="item tabs tabs-icon-left">
                <a class="tab-item" href="{{pathFor 'talk' _id=connectData._id}}">
                  <i class="icon ion-chatbubbles assertive"></i>
                  CHAT
                </a>
                <a class="tab-item" id="btnCallUser">
                  <i class="icon ion-ios-telephone"></i>
                  CALL
                </a>
                {{#if ../paymentPending}}
                  <a class="tab-item" id="cancelRequest">
                      <i class="icon ion-ios-close royal"></i>
                      CANCEL
                  </a>
                {{/if}}
            </div>
            {{#if ../isNotPurchasing}}
            <div class="item details">
              <i class="icon ion-ios-calendar-outline"></i>
              {{../getTotalDays}} ({{../getStartDate}} to {{../getEndDate}})
            </div>
            <div class="item details">
              <i class="icon ion-ios-clock-outline"></i>
              {{../getDaysLeft}}
  <!--            <input type="range" id="myRange" min="0" max="{{connectData.borrowDetails.date.totalDays}}" value="{{../getDaysLeftValue}}" class="range range-assertive" disabled>-->
            </div>
            {{/if}}
            <div class="item details">
                  <i class="icon ion-cash"></i>
                  <span class="price">
                      ${{connectData.borrowDetails.price.total}}
                      <p class="fee">(-10% fee)</p>
                  </span>
            </div>
            {{#if isReturned}}
            {{else}}
              <div class="item details">
                  <i class="icon ion-location"></i>
                    {{#if ../isProductLocation}}
                      <div class="connect-location-box">
                          <a class="location">PRODUCT LOCATION</a>
                          <p class="sublocation">CURRENT LOCATION</p>
                      </div>
                      <i class="icon ion-loop change-location"></i>
                    {{else}}
                        {{#if ../isUserLocation}}
                        <div class="connect-location-box">
                            <a class="location">CURRENT LOCATION</a>
                            <p class="sublocation">PRODUCT LOCATION</p>
                        </div>
                        <i class="icon ion-loop change-location"></i>
                        {{else}}
                          <p>NO LOCATION</p>
                        {{/if}}
                    {{/if}}
              </div>
            {{/if}}

            <div style="padding-bottom:16px;"></div>

          <!--  RENTING  -->
          {{#if ../isNotPurchasing}}

              {{#if alreadyApproved}}
                {{#if returnItem}}
                    <div class="item button-divider ">
                        <button id="confirmReturn" class="button button-block">CONFIRM RETURN</button>
                    </div>
                {{else}}
                    {{#if waitingPayment}}
                        <div class="item button-divider ">
                            <button class="button button-block" disabled>WAITING PAYMENT</button>
                        </div>
                    {{else}}
                        <div class="item button-divider ">
                            <button class="button button-block" disabled>BORROWED</button>
                        </div>
                    {{/if}}
                {{/if}}

                {{#if ../itemReported}}
                    <div class="item self-check-item no-padding-top">
                        <span class="item-reported">ITEM REPORTED</span>
                        <span class="item-reported-message center">The requestor has 24h to return the item and receive your confirmation</span>
                        <span class="time-left">{{../getReportTimeLeft}}</span>
                    </div>
                {{/if}}

              {{else}}
                    {{#if ../isTimeOver}}
                        <div class="item button-divider ">
                            <button class="button button-block" disabled>TIME IS OVER</button>
                        </div>
                    {{else}}
                        <div class="item button-divider ">
                            <button id="ownerAccept" class="button button-block button-energized">ALLOW RENTING</button>
                        </div>
                    {{/if}}
              {{/if}}

           <!--  PURCHASING  -->
           {{else}}
                {{#if alreadyApproved}}
                    {{#if ../confirmSold}}
                        {{#if ../itemReported}}
                            <div class="item button-divider ">
                                <button id="giveFeedback" class="button button-block">CONFIRM RETURN</button>
                            </div>

                            <div class="item self-check-item no-padding-top">
                                <span class="item-reported">ITEM REPORTED</span>
                                <span class="item-reported-message center">The requestor has 24h to return the item and receive your confirmation</span>
                                <span class="time-left">{{../getReportTimeLeft}}</span>
                            </div>

                        {{else}}
                            <div class="item button-divider ">
                                <button id="giveFeedback" class="button button-block">GIVE THE FEEDBACK</button>
                            </div>
                        {{/if}}

                    {{else}}
                        {{#if ../paymentPending}}
                            <div class="item button-divider ">
                                <button class="button button-block" disabled>WAITING PAYMENT</button>
                            </div>

                        {{else}}
                            {{#if ../itemReported}}
                                <div class="item button-divider ">
                                    <button class="button button-block" disabled>WAITING RETURN</button>
                                </div>

                                <div class="item self-check-item no-padding-top">
                                    <span class="item-reported">ITEM REPORTED</span>
                                    <span class="item-reported-message center">The requestor has 24h to return the item and receive your confirmation</span>
                                    <span class="time-left">{{../getReportTimeLeft}}</span>
                                </div>

                            {{else}}
                                <div class="item button-divider ">
                                    <button class="button button-block" disabled>SOLD - WAITING CONFIRMATION</button>
                                </div>
                            {{/if}}
                        {{/if}}
                    {{/if}}
                {{else}}
                     <div class="item button-divider ">
                        <button id="ownerPurchasingAccept" class="button button-block button-energized">ALLOW PURCHASING</button>
                    </div>
                {{/if}}

            {{/if}}
        </div>

        <div class="center">
          <a class="email-support" href="/contact" data-rel='external'>CONTACT US</a>
        </div>

      </div>

    {{/ionContent}}
  {{/ionView}}
</template>
